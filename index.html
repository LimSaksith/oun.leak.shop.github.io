<!DOCTYPE html>
<html lang="km">
<head>
  <meta charset="UTF-8">
  <title>á€á˜áŸ’á˜áœá·á’á¸á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„á á¶á„</title>
  <style>
    body {
      font-family: 'Khmer OS Battambang', sans-serif;
      padding: 20px;
      background: linear-gradient(to right, #fefcea, #f1da36);
    }
    h2 {
      color: #222;
      background-color: #ffe066;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    label, input, select, button {
      display: block;
      margin-bottom: 10px;
      width: 100%;
      max-width: 400px;
    }
    input, select, button {
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    button {
      background-color: #2b8a3e;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }
    button:hover {
      background-color: #237032;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      overflow-x: auto;
      display: block;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #ffd43b;
      color: #222;
    }
    .actions button {
      margin-right: 5px;
      background-color: #e03131;
    }
    .actions button:hover {
      background-color: #c92a2a;
    }
    .summary {
      margin-top: 20px;
      font-weight: bold;
      font-size: 1.1em;
      background-color: #fff3bf;
      padding: 10px;
      border-left: 5px solid #f08c00;
      border-radius: 4px;
    }
    #searchInput, #dateFilter {
      background-color: #fffbe6;
    }
    #pagination {
      margin-top: 15px;
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }
    #pagination button {
      padding: 8px 16px;
      border-radius: 6px;
      border: none;
      background-color: #4dabf7;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    #pagination button:hover:not([disabled]) {
      background-color: #228be6;
    }
    #pagination button[disabled] {
      background-color: #ccc;
      cursor: not-allowed;
      color: #666;
    }
  </style>
</head>
<body>
  <h2>ğŸ’° á€áŸ†áááŸ‹ááŸ’ášá¶á…áŸ†áá¼á›/á…áŸ†áá¶á™ (Oun Leak ShopğŸ˜)</h2>

  <form id="recordForm">
    <label>áˆáŸ’á˜áŸ„áŸ‡á‘áŸ†á“á·á‰:<input type="text" name="itemName" required></label>
    <label>á”áŸ’ášá—áŸá‘:
      <select name="type">
        <option value="income">á…áŸ†áá¼á›</option>
        <option value="expense">á…áŸ†áá¶á™</option>
      </select>
    </label>
    <label>á…áŸ†á“á½á“:<input type="number" name="quantity" min="1" required></label>
    <label>á¯á€áá¶:
      <select name="unit">
        <option value="á€áŸ†á”áŸ‰á»á„">á€áŸ†á”áŸ‰á»á„</option>
        <option value="á€á‰áŸ’á…á”áŸ‹">á€á‰áŸ’á…á”áŸ‹</option>
        <option value="á€áŸáŸ">á€áŸáŸ</option>
        <option value="á•áŸ’áŸáŸá„áŸ—">á•áŸ’áŸáŸá„áŸ—</option>
      </select>
    </label>
    <label>áá˜áŸ’á›áŸƒ (ášáŸ€á›):<input type="number" name="price" required></label>
    <label>á€á¶á›á”ášá·á…áŸ’á†áŸá‘:<input type="date" name="date" required></label>
    <button type="submit">â• á”á‰áŸ’á…á¼á›á€áŸ†áááŸ‹ááŸ’ášá¶</button>
  </form>

  <input type="text" id="searchInput" placeholder="áŸáŸ’áœáŸ‚á„ášá€...">
  <label>á”áŸ’ášá—áŸá‘:
    <select id="typeFilter">
      <option value="">-- á‘á¶áŸ†á„á¢áŸáŸ‹ --</option>
      <option value="income">á…áŸ†áá¼á›</option>
      <option value="expense">á…áŸ†áá¶á™</option>
    </select>
  </label>
  <label>á€á¶á›á”ášá·á…áŸ’á†áŸá‘:<input type="date" id="dateFilter"></label>

  <table id="recordsTable">
    <thead>
      <tr>
        <th>á€á¶á›á”ášá·á…áŸ’á†áŸá‘</th>
        <th>áˆáŸ’á˜áŸ„áŸ‡á‘áŸ†á“á·á‰</th>
        <th>á”áŸ’ášá—áŸá‘</th>
        <th>á…áŸ†á“á½á“</th>
        <th>á¯á€áá¶</th>
        <th>áá˜áŸ’á›áŸƒ</th>
        <th>áŸášá»á”</th>
        <th>á¢á¶á€áŸ’ášá¶á</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>
  <div id="pagination"></div>
  <div class="summary" id="summary"></div>

  <button onclick="clearAll()" style="background-color:#f03e3e">ğŸ—‘ï¸ Clear All</button>
  <button onclick="exportExcel()">ğŸ“Š Export á‡á¶ Excel</button>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const form = document.getElementById('recordForm');
      const tableBody = document.getElementById('tableBody');
      const pagination = document.getElementById('pagination');
      const searchInput = document.getElementById('searchInput');
      const dateInput = document.getElementById('dateFilter');
      const typeFilter = document.getElementById('typeFilter');
      const summary = document.getElementById('summary');
      let records = JSON.parse(localStorage.getItem('records')) || [];
      let filteredRecords = [];
      let currentPage = 1;
      const rowsPerPage = 15;

      function formatCurrency(val) {
        return new Intl.NumberFormat('km-KH', { style: 'currency', currency: 'KHR' }).format(val);
      }

      function paginate(records, page) {
        const start = (page - 1) * rowsPerPage;
        return records.slice(start, start + rowsPerPage);
      }

      function renderPagination(totalRows) {
        const pageCount = Math.ceil(totalRows / rowsPerPage);
        pagination.innerHTML = '';

        const prevBtn = document.createElement('button');
        prevBtn.innerText = 'Â« áá™á€áŸ’ášáŸ„á™';
        prevBtn.disabled = currentPage === 1;
        prevBtn.onclick = () => {
          if (currentPage > 1) {
            currentPage--;
            renderTable();
          }
        };
        pagination.appendChild(prevBtn);

        for (let i = 1; i <= pageCount; i++) {
  const btn = document.createElement('button');
  btn.innerText = i;
  btn.classList.add('page-number-btn');
  if (i === currentPage) {
    btn.style.backgroundColor = '#1971c2';
  }
  btn.onclick = () => {
    currentPage = i;
    renderTable();
  };
  pagination.appendChild(btn);
}

        const nextBtn = document.createElement('button');
        nextBtn.innerText = 'á”á“áŸ’á‘á¶á”áŸ‹ Â»';
        nextBtn.disabled = currentPage === pageCount;
        nextBtn.onclick = () => {
          if (currentPage < pageCount) {
            currentPage++;
            renderTable();
          }
        };
        pagination.appendChild(nextBtn);
      }

      function renderTable() {
        const filterText = searchInput.value.toLowerCase();
        const dateFilterVal = dateInput.value;
        tableBody.innerHTML = '';
        let totalIncome = 0, totalExpense = 0;

        filteredRecords = records
          .filter(r => r.name && r.name.toLowerCase().includes(filterText))
          .filter(r => !dateFilterVal || r.date === dateFilterVal)
          .filter(r => !typeFilter.value || r.type === typeFilter.value)
          .sort((a, b) => new Date(b.date) - new Date(a.date));

        const pageRecords = paginate(filteredRecords, currentPage);

        pageRecords.forEach((r, index) => {
          const total = r.quantity * r.price;
          r.type === 'income' ? totalIncome += total : totalExpense += total;
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${r.date}</td>
            <td>${r.name}</td>
            <td style="color:${r.type === 'income' ? 'green' : 'red'}; font-weight:bold">
              ${r.type === 'income' ? 'á…áŸ†áá¼á›' : 'á…áŸ†áá¶á™'}</td>
            <td>${r.quantity}</td>
            <td>${r.unit}</td>
            <td>${formatCurrency(r.price)}</td>
            <td>${formatCurrency(total)}</td>
            <td class="actions">
              <button onclick="editRecord(${records.indexOf(r)})">á›á»á”</button>
            </td>`;
          tableBody.appendChild(row);
        });

        renderPagination(filteredRecords.length);

        summary.innerHTML = `
          <div style="background-color:#d3f9d8; padding:10px; border-radius:5px; margin-bottom:5px;">
            <span style="color: green">áŸášá»á”á…áŸ†áá¼á›áŸ–</span><br><strong style="color: green">${formatCurrency(totalIncome)}</strong>
          </div>
          <div style="background-color:#ffe3e3; padding:10px; border-radius:5px;">
            <span style="color: red">áŸášá»á”á…áŸ†áá¶á™áŸ–</span><br><strong style="color: red">${formatCurrency(totalExpense)}</strong>
          </div>`;
      }

      window.editRecord = function(index) {
        const r = records[index];
        form.itemName.value = r.name;
        form.type.value = r.type;
        form.quantity.value = r.quantity;
        form.unit.value = r.unit;
        form.price.value = r.price;
        form.date.value = r.date;
        records.splice(index, 1);
        localStorage.setItem('records', JSON.stringify(records));
        renderTable();
      }

      window.exportExcel = function () {
        const headers = ['á€á¶á›á”ášá·á…áŸ’á†áŸá‘', 'áˆáŸ’á˜áŸ„áŸ‡á‘áŸ†á“á·á‰', 'á”áŸ’ášá—áŸá‘', 'á…áŸ†á“á½á“', 'á¯á€áá¶', 'áá˜áŸ’á›áŸƒ (ášáŸ€á›)', 'áŸášá»á” (ášáŸ€á›)'];
        const rows = records.map(r => [
          r.date, r.name, r.type === 'income' ? 'á…áŸ†áá¼á›' : 'á…áŸ†áá¶á™', r.quantity, r.unit, r.price, r.quantity * r.price
        ]);
        let csvContent = 'data:text/csv;charset=utf-8,' + headers.join(',') + '\n';
        rows.forEach(row => { csvContent += row.join(',') + '\n'; });
        const encodedUri = encodeURI(csvContent);
        const link = document.createElement('a');
        link.setAttribute('href', encodedUri);
        link.setAttribute('download', 'OunLeakShop_Report.csv');
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      }

      window.clearAll = function () {
        if (confirm('áá¾á¢áŸ’á“á€á…á„áŸ‹á›á»á”á‘á·á“áŸ’á“á“áŸá™á‘á¶áŸ†á„á¢áŸáŸ‹á˜áŸ‚á“á¬?')) {
          records = [];
          localStorage.removeItem('records');
          renderTable();
        }
      }

      form.onsubmit = (e) => {
        e.preventDefault();
        const item = {
          name: form.itemName.value,
          type: form.type.value,
          quantity: +form.quantity.value,
          unit: form.unit.value,
          price: +form.price.value,
          date: form.date.value
        };
        records.push(item);
        localStorage.setItem('records', JSON.stringify(records));
        form.reset();
        renderTable();
      };

      searchInput.oninput = dateInput.oninput = typeFilter.oninput = () => {
        currentPage = 1;
        renderTable();
      };

      renderTable();
    });
  </script>
</body>
</html>
