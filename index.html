<!DOCTYPE html>
<html lang="km">
<head>
  <meta charset="UTF-8">
  <title>á€á˜áŸ’á˜áœá·á’á¸á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„á á¶á„</title>
  <style>
    body {
      font-family: 'Khmer OS Battambang', sans-serif;
      padding: 20px;
      background: linear-gradient(to right, #fefcea, #f1da36);
    }
    h2 {
      color: #222;
      background-color: #ffe066;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    label {
      display: block;
      margin: 10px 0 5px;
    }
    input, select, button {
      padding: 8px;
      margin-bottom: 10px;
      width: 100%;
      max-width: 400px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    button {
      background-color: #2b8a3e;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }
    button:hover {
      background-color: #237032;
    }
    table {
      page-break-inside: auto;
      max-height: 1000px;
      display: block;
      overflow-x: auto;
      overflow-y: auto;
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background-color: white;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    th {
      background-color: #ffd43b;
      color: #222;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    .actions button {
      margin-right: 5px;
      background-color: #e03131;
    }
    .actions button:hover {
      background-color: #c92a2a;
    }
    .summary {
      margin-top: 20px;
      font-weight: bold;
      font-size: 1.1em;
      background-color: #fff3bf;
      padding: 10px;
      border-left: 5px solid #f08c00;
      border-radius: 4px;
    }
    input[type="text"]#searchInput, input[type="date"]#dateFilter {
      background-color: #fffbe6;
    }
  </style>
</head>
<body>

  <h2>ğŸ’° á€áŸ†áááŸ‹ááŸ’ášá¶á…áŸ†áá¼á›/á…áŸ†áá¶á™ (Oun Leak ShopğŸ˜)</h2>

  <form id="recordForm">
    <label>áˆáŸ’á˜áŸ„áŸ‡á‘áŸ†á“á·á‰:</label>
    <input type="text" id="itemName" required>

    <label>á”áŸ’ášá—áŸá‘:</label>
    <select id="type">
      <option value="income" style="color:green">á…áŸ†áá¼á›</option>
      <option value="expense" style="color:red">á…áŸ†áá¶á™</option>
    </select>

    <label>á…áŸ†á“á½á“:</label>
    <input type="number" id="quantity" min="1" required>

    <label>á¯á€áá¶:</label>
    <select id="unit">
      <option value="á€áŸ†á”áŸ‰á»á„">á€áŸ†á”áŸ‰á»á„</option>
      <option value="á€á‰áŸ’á…á”áŸ‹">á€á‰áŸ’á…á”áŸ‹</option>
      <option value="á€áŸáŸ">á€áŸáŸ</option>
      <option value="á•áŸ’áŸáŸá„áŸ—">á•áŸ’áŸáŸá„áŸ—</option>
    </select>

    <label>áá˜áŸ’á›áŸƒ (ášáŸ€á›):</label>
    <input type="number" id="price" required>

    <label>á€á¶á›á”ášá·á…áŸ’á†áŸá‘:</label>
    <input type="date" id="date" required>

    <button type="submit">â• á”á‰áŸ’á…á¼á›á€áŸ†áááŸ‹ááŸ’ášá¶</button>
  </form>

  <h3>ğŸ” áŸáŸ’áœáŸ‚á„ášá€á€áŸ†áááŸ‹ááŸ’ášá¶</h3>
  <input type="text" id="searchInput" placeholder="áŸáŸ’áœáŸ‚á„ášá€...">
  <label>áŸáŸ’áœáŸ‚á„ášá€á”áŸ’ášá—áŸá‘:</label>
  <select id="typeFilter">
    <option value="">-- á‘á¶áŸ†á„á¢áŸáŸ‹ --</option>
    <option value="income">á…áŸ†áá¼á›</option>
    <option value="expense">á…áŸ†áá¶á™</option>
  </select>
  <label>áŸáŸ’áœáŸ‚á„ášá€áá¶á˜á€á¶á›á”ášá·á…áŸ’á†áŸá‘:</label>
  <input type="date" id="dateFilter">

  <h3>ğŸ“† á…áŸ†áá¼á›/á…áŸ†áá¶á™á”áŸ’ášá…á¶áŸ†ááŸ’á„áŸƒ</h3>
  <table id="recordsTable">
    <thead>
      <tr>
        <th>á€á¶á›á”ášá·á…áŸ’á†áŸá‘</th>
        <th>áˆáŸ’á˜áŸ„áŸ‡á‘áŸ†á“á·á‰</th>
        <th>á”áŸ’ášá—áŸá‘</th>
        <th>á…áŸ†á“á½á“</th>
        <th>á¯á€áá¶</th>
        <th>áá˜áŸ’á›áŸƒ (ášáŸ€á›)</th>
        <th>áŸášá»á” (ášáŸ€á›)</th>
        <th>á¢á¶á€áŸ’ášá¶á</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>

  <div class="summary" id="summary"></div>

  <button onclick="clearAll()" style="background-color:#f03e3e">ğŸ—‘ï¸ Clear All</button>
  <button onclick="exportExcel()">ğŸ“Š Export á‡á¶ Excel</button>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const form = document.getElementById('recordForm');
      const tableBody = document.querySelector('#recordsTable tbody');
      const searchInput = document.getElementById('searchInput');
      const dateInput = document.getElementById('dateFilter');
      const typeFilter = document.getElementById('typeFilter');
      const summaryDiv = document.getElementById('summary');

      let records = JSON.parse(localStorage.getItem('records')) || [];

      form.onsubmit = (e) => {
        e.preventDefault();
        const item = {
          name: document.getElementById('itemName').value,
          type: document.getElementById('type').value,
          quantity: +document.getElementById('quantity').value,
          unit: document.getElementById('unit').value,
          price: +document.getElementById('price').value,
          date: document.getElementById('date').value
        };
        records.push(item);
        localStorage.setItem('records', JSON.stringify(records));
        renderTable();
        form.reset();
      };

      function paginateTable() {
        const rows = document.querySelectorAll('#tableBody tr');
        const rowsPerPage = 15;
        let currentPage = 0;
        function showPage(page) {
          currentPage = page;
          rows.forEach((row, i) => {
            row.style.display = (Math.floor(i / rowsPerPage) === page) ? '' : 'none';
          });
        }
        if (rows.length > rowsPerPage) {
          const pageCount = Math.ceil(rows.length / rowsPerPage);
          const nav = document.createElement('div');
          nav.id = 'pagination';
          nav.style.marginTop = '10px';

          const prevBtn = document.createElement('button');
          prevBtn.innerText = 'Â« áá™á€áŸ’ášáŸ„á™';
          prevBtn.onclick = () => {
            if (currentPage > 0) showPage(currentPage - 1);
          };
          nav.appendChild(prevBtn);

          for (let i = 0; i < pageCount; i++) {
            const btn = document.createElement('button');
            btn.innerText = i + 1;
            btn.onclick = () => showPage(i);
            nav.appendChild(btn);
          }

          const nextBtn = document.createElement('button');
          nextBtn.innerText = 'á”á“áŸ’á‘á¶á”áŸ‹ Â»';
          nextBtn.onclick = () => {
            if (currentPage < pageCount - 1) showPage(currentPage + 1);
          };
          nav.appendChild(nextBtn);

          const existing = document.getElementById('pagination');
          if (existing) existing.remove();
          document.body.appendChild(nav);

          showPage(0);
        }
      }

      searchInput.oninput = renderTable;
      dateInput.oninput = renderTable;
      typeFilter.oninput = renderTable;

      function formatCurrency(value) {
        return new Intl.NumberFormat('km-KH', { style: 'currency', currency: 'KHR' }).format(value);
      }

      function renderTable() {
        const filter = searchInput.value.toLowerCase();
        const dateFilter = dateInput.value;
        tableBody.innerHTML = '';
        let totalIncome = 0;
        let totalExpense = 0;
        records
          .sort((a, b) => new Date(b.date) - new Date(a.date))
          .filter(r => r.name.toLowerCase().includes(filter))
          .filter(r => !dateFilter || r.date === dateFilter)
          .filter(r => !typeFilter.value || r.type === typeFilter.value)
          .forEach((r, index) => {
            const total = r.quantity * r.price;
            if (r.type === 'income') totalIncome += total;
            else totalExpense += total;
            const row = tableBody.insertRow();
            const typeColor = r.type === 'income' ? 'green' : 'red';
            row.innerHTML = `
              <td>${r.date}</td>
              <td>${r.name}</td>
              <td style="color: ${typeColor}; font-weight: bold">${r.type === 'income' ? 'á…áŸ†áá¼á›' : 'á…áŸ†áá¶á™'}</td>
              <td>${r.quantity}</td>
              <td>${r.unit}</td>
              <td>${formatCurrency(r.price)}</td>
              <td>${formatCurrency(total)}</td>
              <td class="actions">
                <button onclick="editRecord(${index})">á›á»á”</button>
              </td>
            `;
          });
        summaryDiv.innerHTML = `
  <div style="background-color:#d3f9d8; padding:10px; border-radius:5px; margin-bottom:5px;">
    <span style="color: green">áŸášá»á”á…áŸ†áá¼á›áŸ–</span><br>
    <strong style="color: green">${formatCurrency(totalIncome)}</strong>
  </div>
  <div style="background-color:#ffe3e3; padding:10px; border-radius:5px;">
    <span style="color: red">áŸášá»á”á…áŸ†áá¶á™áŸ–</span><br>
    <strong style="color: red">${formatCurrency(totalExpense)}</strong>
  </div>`;
        paginateTable();
      }

      window.editRecord = function(index) {
        const r = records[index];
        document.getElementById('itemName').value = r.name;
        document.getElementById('type').value = r.type;
        document.getElementById('quantity').value = r.quantity;
        document.getElementById('unit').value = r.unit;
        document.getElementById('price').value = r.price;
        document.getElementById('date').value = r.date;
        records.splice(index, 1);
        localStorage.setItem('records', JSON.stringify(records));
        renderTable();
      }

      window.exportExcel = function () {
        const headers = ['á€á¶á›á”ášá·á…áŸ’á†áŸá‘', 'áˆáŸ’á˜áŸ„áŸ‡á‘áŸ†á“á·á‰', 'á”áŸ’ášá—áŸá‘', 'á…áŸ†á“á½á“', 'á¯á€áá¶', 'áá˜áŸ’á›áŸƒ (ášáŸ€á›)', 'áŸášá»á” (ášáŸ€á›)'];
        const rows = records.map(r => [
          r.date,
          r.name,
          r.type === 'income' ? 'á…áŸ†áá¼á›' : 'á…áŸ†áá¶á™',
          r.quantity,
          r.unit,
          r.price,
          r.quantity * r.price
        ]);
        let csvContent = 'data:text/csv;charset=utf-8,' + headers.join(',') + '\n';
        rows.forEach(row => {
          csvContent += row.join(',') + '\n';
        });
        const encodedUri = encodeURI(csvContent);
        const link = document.createElement('a');
        link.setAttribute('href', encodedUri);
        link.setAttribute('download', 'OunLeakShop_Report.csv');
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      }

      window.clearAll = function () {
        if (confirm('áá¾á¢áŸ’á“á€á…á„áŸ‹á›á»á”á‘á·á“áŸ’á“á“áŸá™á‘á¶áŸ†á„á¢áŸáŸ‹á˜áŸ‚á“á¬?')) {
          records = [];
          localStorage.removeItem('records');
          renderTable();
        }
      }

      renderTable();
    });
  </script>
</body>
</html>
